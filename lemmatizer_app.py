import streamlit as st
from pymorphy3 import MorphAnalyzer
import re

st.title("üìù –õ–µ–º–º–∞—Ç–∏–∑–∞—Ç–æ—Ä —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
try:
    morph = MorphAnalyzer()
except Exception as e:
    st.error(f"–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: {str(e)}")
    st.stop()

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç
def is_russian(text):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Ç–µ–∫—Å—Ç —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã"""
    russian_letters = re.compile(r'^[–∞-—è–ê-–Ø—ë–Å\s\d\.,!?;:-]+$')
    return bool(russian_letters.fullmatch(text))

text = st.text_area("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç (–Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ!):", 
                   "–ì–∞—Ä—Ä–∏ –Ω–∏–∫–æ–≥–¥–∞ –µ—â–µ —Ç–∞–∫ –Ω–µ –Ω–∞–∫–∞–∑—ã–≤–∞–ª–∏, –∫–∞–∫ –∑–∞ –∏—Å—Ç–æ—Ä–∏—é —Å –±—Ä–∞–∑–∏–ª—å—Å–∫–∏–º —É–¥–∞–≤–æ–º")

if st.button("–õ–µ–º–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å"):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫
    if not is_russian(text):
        st.error("–û—à–∏–±–∫–∞: –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç! –£–¥–∞–ª–∏—Ç–µ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã.")
        st.stop()  # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    
    # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É
    words = text.split()
    lemmas = []
    
    for word in re.findall(r'[–∞-—è–ê-–Ø—ë–Å]+', text):  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —á–∏—Å–ª–∞ –∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é
        try:
            parsed = morph.parse(word)
            if parsed:
                lemmas.append(parsed[0].normal_form)
        except:
            lemmas.append(word)
    
    st.subheader("–†–µ–∑—É–ª—å—Ç–∞—Ç:")
    st.write(" ".join(lemmas))
    st.success(f"–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(lemmas)} —Å–ª–æ–≤")
